/*! backbone-viewmanager@2.0.0 2015-02-22 */
define(["jquery","underscore","backbone"],function(a,b,c){"use strict";var d=function(d){var e=this,f=function(){var a=Date.now(),c=e.timeWindowResized&&a>=e.timeWindowResized+199;return c?(e.timeWindowResized=0,void e.trigger("windowResizeEnd")):(e.timeWindowResized=a,void b.delay(f,200))};b.extend(this,c.Events),d.$&&(a=d.$),this.$=a,this.$el=d.$el||d.el&&this.$(d.el),this.window=d.window,this.$window=this.$(this.window),this.timeWindowResized=0,this.$window.resize(function(){0===e.timeWindowResized&&f()}),this.on("windowResizeEnd",function(){e.resizeModalLayer(),e.resizeViews(),e.updateViewsPosition(),e.trigger("resize",e.getSizes())})};return d.extendView=function(d,e){var f;return void 0===e&&(e=d||{},d=c.View),void 0===e.prototype&&(e=d.extend(e)),f=d.extend(e),b.each(e.prototype,function(a,b){["constructor","render"].indexOf(b)<0&&(f.prototype[b]=a)}),f.prototype.render=function(){this.$el&&this.$el.data("vm-view",this);var a=e.prototype.render.apply(this,arguments);return this.trigger("render",this),a},f.prototype.waitView=function(){var b=this.$(".vm-waitView"),c=this.$el,d=parseInt(c.css("z-index"),10)||0;return c.addClass("vm-waiting"),b.length||(b=a('<div class="vm-waitView"></div>').appendTo(c)),b.css("z-index",d+1),this},f.prototype.resumeView=function(){return this.$(".vm-waitView").remove(),this.$el.removeClass("vm-waiting"),this},f},d.prototype.getMainBarView=function(){var a=this.$el.find(".vm-view-parent>.vm-mainBarView");return a.length?a.parent().data("vm-view"):null},d.prototype.setMainBarTitleText=function(a){var b=this.getMainBarView();return b&&b.setMainBarTitleText(a),this},d.prototype.getMainBarTitleText=function(){var a=this.getMainBarView();return a?a.getMainBarTitleText():void 0},d.prototype.getSizes=function(){var b=a("body"),c=this.getMainBarView(),d=c?c.$(">.vm-mainBarView"):null,e={windowWidth:this.window.innerWidth||0,windowHeight:this.window.innerHeight||0,bodyWidth:b.innerWidth(),bodyHeight:b.innerHeight(),mainBarWidth:d?d.outerWidth():0,mainBarHeight:d?d.outerHeight():0};return e.fullscreenWidth=e.windowWidth||0,e.fullscreenHeight=e.windowHeight||0,e.availableWidth=e.fullscreenWidth||0,e.availableHeight=e.fullscreenHeight-e.mainBarHeight||e.fullscreenHeight,e},d.prototype.resizeModalLayer=function(){var a=this.getModalLayer();return a.css({width:this.$window.innerWidth(),height:this.$window.innerHeight()}),this},d.prototype.resizeViews=function(){var c=this;return b.each(this.$el.find(".vm-view-parent.vm-fullscreen"),function(b){c.resizeView(a(b))}),b.each(this.$el.find(".vm-view-parent.vm-fill"),function(b){c.resizeView(a(b))}),this},d.prototype.updateViewsPosition=function(){var c=this;return b.each(this.$el.find(".vm-view-parent.vm-centered"),function(b){c.positionView(a(b))}),this},d.prototype.getMaxZIndex=function(c){var d,e,f=0;return b.each(this.$el.find(".vm-view-parent"),function(b){e=a(b),d=parseInt(e.css("z-index"),10)||0,d>f&&b!==c&&(f=d)}),f},d.prototype.getTopModalViewEl=function(c){var d,e,f,g=0;return b.each(this.$el.find(".vm-view-parent.vm-modal"),function(b){e=a(b),d=parseInt(e.css("z-index"),10)||0,d>g&&b!==c&&(g=d,f=b)}),f},d.prototype.toFront=function(a){var b=this.getMaxZIndex(a.el),c=a.$el.data("vm-options")||{};return a.$el.css("z-index",b+2),!0===c.modal&&this.showModal(a.$el),this},d.prototype.getModalLayer=function(){var b=a(this.$el.find(".vm-modal-layer")[0]);return 0===b.length&&(b=a("<div></div>").addClass("vm-modal-layer").css({position:"fixed",display:"none",top:0,left:0,"z-index":0}).appendTo(this.$el)),b},d.prototype.showModal=function(a){var b=parseInt(a.css("z-index"),10)||0,c=this.getModalLayer();return 0===b?c.hide():(c.css({"z-index":b-1,display:"block"}),this.resizeModalLayer(),c.show()),this},d.prototype.hideModal=function(b){var c=a(this.$el.find(".vm-modal-layer")[0]),d=this.getTopModalViewEl(b.get(0));return d?this.showModal(a(d)):c.length&&(c.css("z-index",0),c.hide()),this},d.prototype.show=function(b,c){var d=this,e=0!==b.$el.parent().length,f=e?b.$el:a("<div></div>");return c=c||{},b.off(null,null,this),f.data("vm-options",c).addClass("vm-view-parent"),c.fill&&(f.addClass("vm-fill"),b.on("render",function(){d.resizeView(f)},this)),c.fullscreen&&(f.addClass("vm-fullscreen"),b.on("render",function(){d.resizeView(f)},this)),c.center?(f.addClass("vm-centered").css({position:c.position?c.position:"fixed"}),b.on("render",function(){d.positionView(f)},this)):f.removeClass("vm-centered"),!0===c.modal&&(f.addClass("vm-modal"),b.on("render",function(){d.showModal(f)},this),b.once("close",function(){d.hideModal(f)},this)),e||(this.$el.append(f),b.once("close",function(){b.off(null,null,d),f.remove()},this),b.setElement(f)),b.render(),(!0===c.toFront||!0===c.modal)&&this.toFront(b),this},d.prototype.resizeView=function(a){var b,c=a.data("vm-options")||{},d=a.data("vm-view"),e=this.getSizes();return!0===c.fill&&(b={width:e.fullscreenWidth,height:e.availableHeight,position:"absolute",top:e.mainBarHeight,left:0,overflow:"auto"}),!0===c.fullscreen&&(b={width:e.fullscreenWidth,height:e.fullscreenHeight,position:"fixed",top:0,left:0,overflow:"auto"}),b&&(a.css(b),d&&d.trigger("resize",e)),this},d.prototype.positionView=function(a){var b=a.data("vm-options")||{},c=this.getSizes(),d=a.outerWidth(),e=a.outerHeight(),f=!0===b.fullscreen?c.windowWidth:c.availableWidth,g=!0===b.fullscreen?c.windowHeight:c.availableHeight,h={};return("vertical"===b.center||"both"===b.center)&&(h.top=g/2-e/2+(!0===b.fullscreen?0:c.mainBarHeight)),("horizontal"===b.center||"both"===b.center)&&(h.left=f/2-d/2),a.css(h),this},d});